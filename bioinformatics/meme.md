# Background

Motif matrices $\in [0,1]^{W \times L}$
- Consider $N$ aligned sequences of length $W$ generated from an alphabet of size $L$ contributing to the motif matrix. Let $b = (b_1, ..., b_L)$ be the background probabilities.
- Types
    - $C$: position frequencey matrix (PFM): counts
    - $F$: position(-specific) probability matrix (PPM, PSPM): probabilities
    - $S$: position(-specific) weight/scoring matrix (PWM, PSWM, PSSM): weights, often given as log-likelihoods (aka log-odds) with added pseudocounts
$$ S_{ij} = \log \frac{\text{observed}}{\text{expected}} = \log \frac{C_{ij}}{N b_j} = \log \frac{f_{ij}}{b_j} \approx \log \frac{C_{ij} + 1}{(N + 1) b_j}$$
- Assumption: each column/position is an independent multinomial distribution
  - The probability of a sequence $x$ given a PPM $F$ is the multiplication of the relevant probabilities at each position:

$$\begin{gathered}
f_{ij} = \frac{C_{ij}}{N} \\
p(x \mid F) = \Pi_{i=1}^W \Pi_{j=1}^L f_{ij}^{I(j, x_i)} \\
\log {p(x \mid F)} = \log \left(\Pi_{i=1}^W \Pi_{j=1}^L f_{ij}^{I(j, x_i)} \right) = 
\sum_{i=1}^W \sum_{j=1}^L \log f_{ij}^{I(j, x_i)} \\
I(j, x_i) = \begin{cases} 1, &\text{ if } x_i = a_j \\ 0, &\text{ otherwise} \end{cases}
\end{gathered}$$

References
- [Wikipedia: Position weight matrix](https://en.wikipedia.org/wiki/Position_weight_matrix)
- Hertz, Gerald Z, George W Hartzell, and Gary D Stormo. “Identification of Consensus Patterns in Unaligned DNA Sequences Known to Be Functionally Related.” *Computer Applications in the Biosciences* 6.2 (1990): 81–92. https://doi.org/10.1093/bioinformatics/6.2.81

# Motif-finding programs

Score $s$ for a PPM $F$ and sequence $x$ (used by FIMO, MAST, and HOMER):
$$\begin{aligned}
s(x, F) &= \sum_{i=1}^W \sum_{j=1}^L S_{ij}^{I(j, x_i)} \\
&= \sum_{i=1}^W \sum_{j=1}^L \left(\log \frac{f_{ij}}{b_j} \right)^{I(j, x_i)} \\
&= \sum_{i=1}^W \sum_{j=1}^L \log \left(\frac{f_{ij}}{b_j} \right)^{I(j, x_i)} \\
&= \log \left(\Pi_{i=1}^W \Pi_{j=1}^L \left(\frac{f_{ij}}{b_j}\right)^{I(j, x_i)} \right) \\
&= \log {p(x \mid F')} \text{, where } F'_{ij}=\frac{f_{ij}}{b_j}
\end{aligned}$$
- Note: [HOMER](http://homer.ucsd.edu/homer/motif/creatingCustomMotifs.html) fixes $b_j = 0.25$

Score threshold for classifying a sequence as containing the motif or not
- MEME: 
- HOMER: 

# Bailey and Elkan. Fitting a Mixture Model by Expectation Maximization to Discover Motifs in Biopolymers

References
- UCSD Technical Report CS94-351, which provides more detailed mathematical background
- Paper in the *International Conference on Intelligent Systems for Molecular Biology*

Model
- $X = (X_1, ..., X_n)$: dataset of $n$ overlapping $W$-mers
- $A = (a_1, ..., a_L)$: alphabet, i.e., $A = (\text{A}, \text{C}, \text{G}, \text{T})$
- $f \in [0,1]^{W \times L}$: position probability matrix (PPM)
  - $f_0 \in [0,1]^L$: background model
- $\lambda = (\lambda_1, \lambda_2)$: mixing parameter - probability that a sequence of length $W$ is generated by the motif ($\lambda_1$) versus the background model ($\lambda_2 = 1 - \lambda_1$)
- $\theta = (\theta_1, \theta_2) = (f, f_0)$

Missing data: $Z \in \{0,1\}^{n \times 2}$, where $Z_{ij} = 1$ if $X_i$ is from group $j$, $0$ otherwise.
- Describes group membership: whether the $W$-mer $X_i$ came from the motif group ($j=1$) or background ($j=2$)