# Background

Motif matrices $\in [0,1]^{W \times L}$
- Consider $N$ aligned sequences of length $W$ generated from an alphabet of size $L$ contributing to the motif matrix. Let $b = (b_1, ..., b_L)$ be the background probabilities.
- Types
    - $C$: position frequency matrix (PFM): counts
    - $F$: position(-specific) probability matrix (PPM, PSPM): probabilities
    - $S$: position(-specific) weight/scoring matrix (PWM, PSWM, PSSM): weights, often given as log-likelihoods (aka log-odds) with added pseudocounts

$$ S_{ij} = \log \frac{\text{observed}}{\text{expected}} = \log \frac{C_{ij}}{N b_j} = \log \frac{f_{ij}}{b_j} \approx \log \frac{C_{ij} + 1}{(N + 1) b_j} $$

- Assumption: each column/position is an independent multinomial distribution
  - The probability of a sequence $x$ given a PPM $F$ is the multiplication of the relevant probabilities at each position:

$$\begin{gathered}
f_{ij} = \frac{C_{ij}}{N} \\
p(x \mid F) = \Pi_{i=1}^W \Pi_{j=1}^L f_{ij}^{I(j, x_i)} \\
\log {p(x \mid F)} = \log \left(\Pi_{i=1}^W \Pi_{j=1}^L f_{ij}^{I(j, x_i)} \right) = 
\sum_{i=1}^W \sum_{j=1}^L \log f_{ij}^{I(j, x_i)} \\
I(j, x_i) = \begin{cases} 1, &\text{ if } x_i = a_j \\ 0, &\text{ otherwise} \end{cases}
\end{gathered}$$

References
- [Wikipedia: Position weight matrix](https://en.wikipedia.org/wiki/Position_weight_matrix)
- Hertz, Gerald Z, George W Hartzell, and Gary D Stormo. “Identification of Consensus Patterns in Unaligned DNA Sequences Known to Be Functionally Related.” *Computer Applications in the Biosciences* 6.2 (1990): 81–92. https://doi.org/10.1093/bioinformatics/6.2.81

# Motif-finding programs

Score $s$ for a PPM $F$ and sequence $x$ (used by FIMO, MAST, and HOMER):

```math
\begin{aligned}
s(x, F) &= \sum_{i=1}^W \sum_{j=1}^L S_{ij}^{I(j, x_i)} \\
&= \sum_{i=1}^W \sum_{j=1}^L \left(\log \frac{f_{ij}}{b_j} \right)^{I(j, x_i)} \\
&= \sum_{i=1}^W \sum_{j=1}^L \log \left(\frac{f_{ij}}{b_j} \right)^{I(j, x_i)} \\
&= \log \left(\Pi_{i=1}^W \Pi_{j=1}^L \left(\frac{f_{ij}}{b_j}\right)^{I(j, x_i)} \right) \\
&= \log {p(x \mid F')} \text{, where } F'_{ij}=\frac{f_{ij}}{b_j}
\end{aligned}
```

- Note: [HOMER](http://homer.ucsd.edu/homer/motif/creatingCustomMotifs.html) fixes $b_j = 0.25$

Score threshold for classifying a sequence as containing the motif or not
- MEME: 
- HOMER: 

# SEA

Bailey TL, Grant CE. SEA: Simple Enrichment Analysis of motifs. *bioRxiv*; 2021. doi:[10.1101/2021.08.23.457422v1](https://doi.org/10.1101/2021.08.23.457422v1).

Output files
- sequences.tsv
  - Each row represents a sequence-motif pair where the motif score for that sequence reaches the score threshold for that motif (which is reported in sea.tsv and sea.html). Consequently, each row is a "positive" sequence.
    - A "false positive" (fp) sequence is a control sequence. If no specific set of control sequences was provided via the `--n` option, SEA uses shuffled input sequences as the control set. It seems like SEA retains the names of the original input sequences in the control set.
    - A "true positive" (tp) sequence is a "primary" user-provided sequence.
    - In sea.tsv/sea.html, the TP number for a motif is the number of true positive, non-holdout rows in sequences.tsv. The FP number for a motif is the number of false positive, non-holdout rows in sequences.tsv. The denominator is the number non-holdout primary sequences (90% of the "primary" sequences, unless the number of primary sequences was too low); this denominator is reported in sea.html.
- sea.tsv / sea.html
  - P-value calculation
    - If the primary and control sequences are of the same length, SEA uses Fisher's exact test to calculate a p-value:

      ```
      scipy.stats.fisher_exact(
        [[tp, n_primary_non_holdout - tp],
         [fp, n_control_non_holdout - fp]],
        alternative='greater'
      ).pvalue
      ```
    - If the primary and control sequences are not of the same length, SEA uses a Binomial distribution. See the SEA preprint methods section for details.

# FIMO

https://groups.google.com/g/meme-suite/c/BXv4pRCacN8

https://academic.oup.com/bioinformatics/article/23/5/531/238680

https://genomebiology.biomedcentral.com/articles/10.1186/gb-2007-8-2-r24

https://www.bioconductor.org/packages/release/bioc/html/universalmotif.html

# Bailey and Elkan. Fitting a Mixture Model by Expectation Maximization to Discover Motifs in Biopolymers

References
- UCSD Technical Report CS94-351, which provides more detailed mathematical background
- Paper in the *International Conference on Intelligent Systems for Molecular Biology*

Model
- $X = (X_1, ..., X_n)$: dataset of $n$ overlapping $W$-mers
- $A = (a_1, ..., a_L)$: alphabet, i.e., $A = (\text{A}, \text{C}, \text{G}, \text{T})$
- $f \in [0,1]^{W \times L}$: position probability matrix (PPM)
  - $f_0 \in [0,1]^L$: background model
- $\lambda = (\lambda_1, \lambda_2)$: mixing parameter - probability that a sequence of length $W$ is generated by the motif ($\lambda_1$) versus the background model ($\lambda_2 = 1 - \lambda_1$)
- $\theta = (\theta_1, \theta_2) = (f, f_0)$

Missing data: $Z \in \{0,1\}^{n \times 2}$, where $Z_{ij} = 1$ if $X_i$ is from group $j$, $0$ otherwise.
- Describes group membership: whether the $W$-mer $X_i$ came from the motif group ($j=1$) or background ($j=2$)

# MAST

The scores output by MAST are 100x those output by FIMO: 100 * log2(probability of observing the sequence given that it is part of the motif / probability of observing the sequence given that it is part of the background).

See `src/motif.c:convert_freqs_into_scores()` and https://groups.google.com/g/meme-suite/c/EaSQ5PV-8v0.
